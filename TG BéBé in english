# How to use Spiec-Easi?

---
titre: "How to use Spiec-Easi?"
autehor: "Paola Fournier" 
date: "21/06/2021"
sortie: htlm_document
---
# How to use Spiec-Easi (Sparse and Compositionally Robust Inference of Microbial Ecological Networks)?

This tutorial is intended for novices who wants to get acquainted with network inference via the Spiec-Easi model (Kurtz et al., 2015). 

Github (: https://github.com/zdk123/SpiecEasi  
doi : https://doi.org/10.1371/journal.pcbi.1004226 

I chose this model because it addresses two major problems of correlation-based models:   

  1)it uses the concept of conditional dependence to avoid the detection of correlated but indirectly connected taxa. Correlation is a pairwise metric and therefore limited in a multivariate framework.
  2)it takes into account the compositionality of the data by applying a "clr" transformation on the input abundance table.
  
## **Some important concepts before embarking on microbial network inference**
### Compositional data
let's speak first about how amplicon sequencing data is generated and why that can be a problem 

**What is a compositional data ?**   
Compositional data is defined as a vector of strictly positive real numbers with an unknown or uninformative total (e.g., sequencing depth) because the abundance of each component carries only relative information (Pawlowsky-Glahn et al., 2015). 

**How are amplicon sequencing data compositional?**
Sequencing machines can only provide reads up to their capacity, and therefore each sample is subjected to an arbitrary constant sum constraint. NGS-derived datasets are therefore compositional in nature. 

**What are the consequences?**
The number of reads per sample is not fully interpretable by itself: the total number of reads assigned to a sample or taxa do not provide any information about the number of DNA molecules in the original samples.   
Only the relative changes can be oberved: samples cannot be directly compared because they have a specific sequencing depth. 
Many statistical methods should not be used because they assume independence between features (e.g., abondance of each taxa in one sample), which is not the case for NGS generated data.   

**Litterature and proposed solutions**
A popular technique for recalculating absolute abundances is to compare the log ratio of counts to a reference species. In this case, the reference species is known to have an approximately stable abundance across populations. These ratios are compared instead of counts directly.      
If such a species is not known or not available, the reference can be replaced by a robust composite measure obtained from various species. One such measure is the geometric mean of all counts in the sample. This method assumes that an aggregate of various species does not change in mass between their original environments. Figure 1 illustrates the application of alr and clr transformation


<img src="https://github.com/paoluxe/How-to-use-SpiecEasi-/blob/5d1ce20694fb1a99d621cc01e3b2f2cb4f884c21/Pictures%20README/log-ratio.PNG">


### Principle of co-occurrence networks    
Co-occurrence networks require as input abundance tables of taxa from multiple samples. When two taxa co-occur or show a similar abundance pattern among multiple samples, a co-occurence is assumed between them. A positive link is shown in green (graph) or a "1" in the adjacency table (see below). Conversely, when these two taxa are mutually exclusive, a co-exclusion is assumed, illustrated by a red link connecting two nodes (graph) or a "-1" in the adjacency table (see below). 
<p align="center">
<img src="https://github.com/paoluxe/How-to-use-SpiecEasi-/blob/ef1049e3acef34d2c039fd7aee9abb8fbc162609/Pictures%20README/Principe%20R%C3%A9seaux%20de%20co-occurrence.PNG" width = "700">
</p>

### How SpiecEasi works (mb method)  

